COMMENT		: COMMENT_L|COMMENT_ML
COMMENT_L	: '//' ~[\n\r]*
COMMENT_ML	: '/*' .*? '*/'
STRING		: STRING_STD|STRING_VERB|STRING_INT
STRING_STD	: '"' ('\\"'|'\\\\'|.)*? '"'
STRING_VERB	: '@'('"' (~["]|'""')* '"')+
STRING_INT	: '$"' ('\\"'|'\\\\'|'{{'|STRING_INT_CODE|.)*? ["\n\r]
STRING_INT_CODE : '{' (STRING|CHAR|STRING_INT_CODE|.)*? '}'
CHAR		: '\'' ('\\\''|'\\\\'|.)*? '\''
ID			: [_a-zA-Z][_0-9a-zA-Z]*

file	=	(if|define|undef|Any)+

if_part		=	'#if' condition (Any|if)+
elif_part	=	'#elif' condition (Any|if)+
else_part	=	'#else' (Any|if)+
endif_part	=	'#endif'

if		=	if_part elif_part* else_part? endif_part
define	=	'#define' ID
undef	=	'#undef' ID

condition	=	ands or_right
or_right	=	| '||' ands or_right
ands		=	atom_or_neg and_right
and_right	=	| '&&' atom_or_neg and_right
atom_or_neg	=	atom | '!' atom
atom		=	ID | '(' condition ')'

%%

%parsing fragment STRING_INT_CODE
%parsing ignoreundefined
%parsing start file
%parsing skip COMMENT STRING CHAR
 